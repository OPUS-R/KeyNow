<KeyNow使い方>

–一般コマンド一覧-

①学生番号認証
番号:<学生番号>

例
番号:11mk987i

②借りる

借りる
鍵名


鍵名選択肢:<音倉/音練/両方>

例:借りる 
　 音倉

⇒管理グループに借りた人と鍵の通知が送られる


③返却

返却
鍵名


鍵名選択肢:<音倉/音練/両方>

例:返却
　 音倉

⇒管理グループに借りた人と鍵の通知が送られる



④引き継ぎ(引き継ぐ人が入力する)



引き継ぎ
鍵名


鍵名選択肢:<音倉/音練/両方>

例:引き継ぎ 
　 音倉

⇒管理グループに引き継ぐ前と後の人、鍵の通知が送られる

④鍵確認
「鍵確認」と送信することで、現在の鍵の保有情報を知れる

注意:両方を選択する場合は鍵の保有者が同一の必要あり。


—------------------------------------------------------------------------------------------------------------------------

-管理コマンド一覧-

①グループ認証
管理グループに「####」と送信する。

②履歴確認
管理グループに「履歴確認」と送信することで、過去30日分の鍵の保有情報が見れる(膨大)

③鍵保有をリセットする
管理グループに「リセット鍵情報」と送ることで、鍵の保有情報をリセットできる。

④認証グループ削除
認証グループで「OPUS&Delete」と送信する

⑤履歴削除
管理グループで「履歴削除」と入力する

—--------------------------------------------------------------------------------------------------------------------------

-基本仕様-

①学籍番号-名前の照合について
以下のシートに学籍番号を左、名前を右に入れることで突合可能。
名簿DB<会計の支払い管理用DBと同一>

②鍵の返却時間通知について
原則21時に帰ってこなかったら通知を送る。
以下のシートに日付を左、使用可能時刻を右に入れることで時間指定可能(つまり18時までしか借りられていない時などに18時に通知を送る事が出来る)
記述方法<日付:20xx/mm/dd><時間:14-18>
KeyNow



—---------------------------------------------------------------------------------------------------------------------------

-専門的諸々-

１.動作環境
WebArenaIndigo-4CPU-4GB/500Mbs
Ubuntu:22.04

2.システム要件
Python 3.10以上
Flask
APScheduler
SQLite3
gspread（Google Sheets API）
PyDrive（Google Drive API）
LINE Messaging API
httpx

3. 構成概要
   3.1. システム構成
   LINE Bot API：メッセージの送受信を管理
   Flask：Webhookの受信と応答
   APScheduler：定期タスク管理（鍵リセット・未返却チェック）
   Google Sheets：名簿管理と予約状況の管理
   SQLite3：鍵貸出情報とログ管理
   ログファイル：操作履歴を記録
   3.2. データベース構成
   usersテーブル
   line_id: LINEユーザーID
   student_no: 学生番号
   name: 名前
   groupsテーブル
   group_id: グループID
   key_holdersテーブル
   key_name: 鍵名
   holder_id: 鍵を借りたユーザーID
   borrow_time: 貸出日時
   key_logsテーブル
   action: 操作（借りる、返却、引き継ぎ）
   key_name: 鍵名
   user_name: 操作者名
   timestamp: 操作日時
   4.認証用ファイル各種
   4.1-グーグル認証情報➡GCOA.json
   4.2-LINE認証情報➡line.json





開発環境
windows11 home edition
Ryzen 5 4600-32GB-GTX1660s
Python 3.12
Intellij Home Edition 2024.1.4

開発連絡先

eiminnfuton@gmail.com

